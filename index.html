<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rem</title>
    <!-- KaTeX CSS -->
    <link href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet">
    <!-- KaTeX JS -->
    <script src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <!-- ğŸ¨ è•¾å§†çš„ä¸»é¢˜åˆå§‹åŒ–è„šæœ¬ - é˜²æ­¢ç™½å±é—ªçƒ -->
    <script>
      (function() {
        try {
          // ä» localStorage è¯»å–ä¸»é¢˜è®¾ç½®
          const storageKey = 'onir-theme-storage' 
          const storedData = localStorage.getItem(storageKey)

          let resolvedTheme = 'light' // é»˜è®¤æµ…è‰²

          if (storedData) {
            const parsed = JSON.parse(storedData)
            const mode = parsed.state?.mode

            if (mode) {
              // è§£æå®é™…ä¸»é¢˜ï¼ˆå¤„ç† system æ¨¡å¼ï¼‰
              resolvedTheme = mode === 'system'
                ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
                : mode

              // åœ¨ DOM åŠ è½½å‰ç«‹å³åº”ç”¨ä¸»é¢˜ class
              if (resolvedTheme === 'dark') {
                document.documentElement.classList.add('dark')
              }
            }

            // åŒæ—¶åº”ç”¨å…¶ä»–ä¸»é¢˜è®¾ç½®ï¼ˆé¿å…äºŒæ¬¡é—ªçƒï¼‰
            const accentColor = parsed.state?.accentColor
            const fontSize = parsed.state?.fontSize
            const animations = parsed.state?.animations
            const highRefresh = parsed.state?.highRefresh

            if (accentColor) document.documentElement.setAttribute('data-theme-color', accentColor)
            if (fontSize) document.documentElement.setAttribute('data-font-size', fontSize.toString())
            if (animations !== undefined) document.documentElement.setAttribute('data-animations', animations.toString())
            if (highRefresh !== undefined) document.documentElement.setAttribute('data-high-refresh', highRefresh.toString())
          }

          // ğŸ¯ å…³é”®ï¼šæ ¹æ®è§£æçš„ä¸»é¢˜ï¼ŒåŠ¨æ€è®¾ç½® body çš„èƒŒæ™¯è‰²
          // è¿™æ ·åœ¨ CSS åŠ è½½å‰å°±æœ‰æ­£ç¡®çš„èƒŒæ™¯è‰²äº†
          const backgroundColor = resolvedTheme === 'dark' ? '#000000' : '#f5f5f7'
          document.write('<style>body{background-color:' + backgroundColor + ';margin:0;padding:0;}</style>')

        } catch (error) {
          console.warn('è•¾å§†çš„ä¸»é¢˜åˆå§‹åŒ–å¤±è´¥:', error)
          // å‡ºé”™æ—¶ä½¿ç”¨æµ…è‰²ä½œä¸ºåå¤‡
          document.write('<style>body{background-color:#f5f5f7;margin:0;padding:0;}</style>')
        }
      })()
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
